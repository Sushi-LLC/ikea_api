#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH –∫–ª—é—á–∞ –¥–ª—è GitHub –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

set -e

SERVER="deploy@45.135.234.22"

echo "üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–∞ –¥–ª—è GitHub..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö SSH –∫–ª—é—á–µ–π..."
ssh $SERVER << 'EOF'
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏
if [ -f ~/.ssh/id_ed25519.pub ]; then
    echo "‚úÖ –ù–∞–π–¥–µ–Ω –∫–ª—é—á id_ed25519"
    cat ~/.ssh/id_ed25519.pub
elif [ -f ~/.ssh/id_rsa.pub ]; then
    echo "‚úÖ –ù–∞–π–¥–µ–Ω –∫–ª—é—á id_rsa"
    cat ~/.ssh/id_rsa.pub
else
    echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ SSH –∫–ª—é—á–∞..."
    ssh-keygen -t ed25519 -C "deploy@ikea_api" -f ~/.ssh/id_ed25519 -N ""
    echo "‚úÖ SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω"
    cat ~/.ssh/id_ed25519.pub
fi
EOF

echo ""
echo "üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo ""
echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤—ã—à–µ"
echo ""
echo "2. –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ GitHub:"
echo "   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://github.com/settings/ssh/new"
echo "   - –í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á"
echo "   - –ù–∞–∂–º–∏—Ç–µ 'Add SSH key'"
echo ""
echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:"
echo "   ssh deploy@45.135.234.22 'ssh -T git@github.com'"
echo ""
echo "4. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á –≤—Ä—É—á–Ω—É—é:"
echo "   ssh deploy@45.135.234.22 'cat ~/.ssh/id_ed25519.pub'"
echo ""

